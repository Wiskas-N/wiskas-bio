<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>чипсики</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="styles.css">
</head>

<body>

<div class="background">
    <video id="bg-video" muted playsinline>
        <source src="background.mp4" type="video/mp4">
    </video>
</div>

<div class="overlay"></div>

<div id="start-screen">
    <div class="start-title">Tap to enter</div>
</div>

<div class="container">

    <div class="section hero">
        <div class="avatar">
            <img src="avatar.png">
        </div>
        <h1>wiskas</h1>
        <p>web-designer</p>
    </div>

    <div class="section">
        <div class="section-title">Mods</div>
        <div class="links">

            <a class="link-item" href="https://t.me/rivalvisual" data-id="rivalclicks">
                <div class="link-title">Rival Visuals</div>
                <div class="link-url">Minecraft 1.21.4 and 1.21.8 visuals</div>
            </a>

            <a class="link-item" href="https://t.me/soupvisuals" data-id="soupclicks">
                <div class="link-title">Soup Visuals</div>
                <div class="link-url">Minecraft 1.21.4 visuals</div>
            </a>

        </div>
    </div>

    <div class="section">
        <div class="section-title">Statistics</div>
        <div class="stats-card" id="views">
            Views: 0
        </div>
    </div>

</div>

<script>
const startScreen = document.getElementById('start-screen');
const video = document.getElementById('bg-video');

const MAX_VOLUME = 0.55;
const FADE_IN = 1.2;
const FADE_OUT = 2.5;
const STEP = 40;

let fadeInterval = null;
let startedByUser = false;

function fadeVolume(from, to, duration) {
    if (fadeInterval) clearInterval(fadeInterval);

    const steps = (duration * 1000) / STEP;
    const step = (to - from) / steps;
    let current = from;

    fadeInterval = setInterval(() => {
        current += step;
        video.volume = Math.max(0, Math.min(MAX_VOLUME, current));

        if (
            (step > 0 && current >= to) ||
            (step < 0 && current <= to)
        ) {
            video.volume = to;
            clearInterval(fadeInterval);
            fadeInterval = null;
        }
    }, STEP);
}

startScreen.addEventListener('click', () => {
    startedByUser = true;
    video.muted = true;
    video.volume = 0;
    video.currentTime = 0;
    video.play();
    startScreen.classList.add('hidden');
});

video.addEventListener('play', () => {
    if (!startedByUser) return;

    setTimeout(() => {
        video.muted = false;
        fadeVolume(0, MAX_VOLUME, FADE_IN);
    }, 100);
});

video.addEventListener('timeupdate', () => {
    if (!video.duration || fadeInterval) return;

    const timeLeft = video.duration - video.currentTime;
    if (timeLeft <= FADE_OUT) {
        fadeVolume(video.volume, 0, timeLeft);
    }
});

video.addEventListener('ended', () => {
    video.muted = true;
    video.volume = 0;
    video.currentTime = 0;
    video.play();
});
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, setDoc, increment, onSnapshot }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSy...",
  authDomain: "wiskas.firebaseapp.com",
  projectId: "wiskas",
  storageBucket: "wiskas.firebasestorage.app",
  messagingSenderId: "168046348967",
  appId: "1:168046348967:web:618ed62b398042861ca982"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const bioRef = doc(db, "stats", "bio");

async function incrementViewOnce() {
  const counted = localStorage.getItem("bio_view_counted");

  if (!counted) {
    await setDoc(
      bioRef,
      { views: increment(1) },
      { merge: true }
    );

    localStorage.setItem("bio_view_counted", "true");
  }
}

incrementViewOnce();

onSnapshot(bioRef, snap => {
  if (!snap.exists()) return;

  const data = snap.data();
  document.getElementById("views").textContent =
    "Views: " + (data.views || 0);
});

document.querySelectorAll(".link-item").forEach(link => {
  link.addEventListener("click", async (e) => {
    const field = link.dataset.id;
    if (!field) return;

    e.preventDefault();

    await setDoc(
      bioRef,
      {
        clicks_total: increment(1),
        [field]: increment(1)
      },
      { merge: true }
    );

    window.location.href = link.href;
  });
});
</script>

</body>

</html>
